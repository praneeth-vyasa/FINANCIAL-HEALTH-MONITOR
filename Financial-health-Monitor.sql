drop table Customers_Table
create table Customers_Table (
	Customer_ID  INT primary key,
	First_Name VARCHAR(50),
	Last_Name VARCHAR(50),
	Email VARCHAR(50),
	dob DATE
);
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (1, 'Brittni', 'Lapish', 'blapish0@spotify.com', '1986-08-25 06:35:14');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (2, 'Lloyd', 'Guyton', 'lguyton1@youtube.com', '1985-08-02 05:26:25');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (3, 'Thedrick', 'Tavernor', 'ttavernor2@ox.ac.uk', '1997-10-13 21:42:29');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (4, 'Ede', 'Peasnone', 'epeasnone3@europa.eu', '1988-02-12 14:58:31');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (5, 'Drucy', 'McGlone', 'dmcglone4@gmpg.org', '1995-02-21 11:22:47');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (6, 'Danila', 'Artingstall', 'dartingstall5@yellowbook.com', '1990-07-03 03:29:44');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (7, 'Gilbertina', 'Manhare', 'gmanhare6@1688.com', '1987-03-15 06:18:17');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (8, 'Marlin', 'Caizley', 'mcaizley7@soundcloud.com', '1994-03-16 07:23:03');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (9, 'Carlynn', 'Storre', 'cstorre8@qq.com', '1989-09-07 07:42:47');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (10, 'Johnna', 'Royds', 'jroyds9@flickr.com', '1995-09-02 16:59:28');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (11, 'Giacopo', 'Cristofor', 'gcristofora@hubpages.com', '1995-05-27 05:48:14');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (12, 'Veronika', 'Muirhead', 'vmuirheadb@php.net', '1994-08-17 13:56:06');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (13, 'Wally', 'Liepmann', 'wliepmannc@hud.gov', '1989-05-28 11:28:47');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (14, 'Kenn', 'Piggford', 'kpiggfordd@phoca.cz', '1987-11-24 14:06:05');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (15, 'Kipper', 'Caherny', 'kcahernye@biglobe.ne.jp', '1996-03-12 08:50:27');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (16, 'Sue', 'Bautiste', 'sbautistef@symantec.com', '1997-05-19 03:55:37');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (17, 'Brantley', 'Amsberger', 'bamsbergerg@tripod.com', '1996-07-30 00:50:45');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (18, 'Thornie', 'Briand', 'tbriandh@senate.gov', '1994-09-11 03:52:27');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (19, 'Sapphire', 'Patifield', 'spatifieldi@smugmug.com', '1998-04-21 18:20:50');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (20, 'Cesaro', 'Leopard', 'cleopardj@geocities.com', '1985-06-30 11:18:12');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (21, 'Holli', 'Hadden', 'hhaddenk@yelp.com', '1993-03-01 16:24:11');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (22, 'Nananne', 'Ruzic', 'nruzicl@mozilla.com', '2000-01-22 16:31:52');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (23, 'Franky', 'Nisbith', 'fnisbithm@businessinsider.com', '1991-05-13 04:47:38');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (24, 'Zuzana', 'Smidmore', 'zsmidmoren@wikispaces.com', '1986-11-06 10:37:28');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (25, 'Cherlyn', 'Quillinane', 'cquillinaneo@youku.com', '1990-10-20 09:27:16');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (26, 'Wat', 'Yegorchenkov', 'wyegorchenkovp@google.nl', '1995-12-11 14:31:25');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (27, 'Cecile', 'Twentyman', 'ctwentymanq@ox.ac.uk', '1990-12-19 22:32:52');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (28, 'Gibb', 'Levin', 'glevinr@hibu.com', '1988-02-18 05:51:45');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (29, 'Duffie', 'Grainger', 'dgraingers@ifeng.com', '1992-07-22 20:40:58');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (30, 'Benson', 'Brislane', 'bbrislanet@spiegel.de', '1986-01-29 14:59:56');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (31, 'Beverlie', 'Kamiyama', 'bkamiyamau@t-online.de', '1985-03-29 12:40:13');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (32, 'Urson', 'Abramchik', 'uabramchikv@ocn.ne.jp', '1985-10-03 09:22:47');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (33, 'Wait', 'MacFall', 'wmacfallw@cmu.edu', '1988-07-12 19:42:46');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (34, 'Coraline', 'Culpin', 'cculpinx@biglobe.ne.jp', '1993-07-11 21:33:31');
insert into Customers_Table (Customer_ID , First_Name, Last_Name, Email, dob) values (35, 'Chrissy', 'Vanichev', 'cvanichevy@usgs.gov', '1994-03-12 09:33:46');


create table Transactions_Table (
	AccountID INT foreign key references Accounts_Table(AccountID),
	Transaction_ID  INT primary key,
	Transaction_Type VARCHAR(10),
	Amount INT,
	Transaction_Date DATE,
	Description VARCHAR(15)
);
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (1, 36, 'Transfer', 5267, 'Online Transfer', '6/11/2020');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (4, 37, 'Transfer', 5574, 'Deposit', '4/19/2020');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (5, 38, 'Deposit', 5230, 'Online Transfer', '11/28/2021');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (5, 39, 'Transfer', 6072, 'Deposit', '8/11/2021');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (5, 40, 'Transfer', 7643, 'Deposit', '11/6/2019');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (4, 41, 'Withdrawal', 6181, 'ATM Withdrawal', '9/29/2019');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (3, 42, 'Withdrawal', 5254, 'ATM Withdrawal', '5/11/2020');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (3, 43, 'Transfer', 6058, 'Deposit', '9/27/2019');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (3, 44, 'Transfer', 8135, 'Deposit', '8/22/2020');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (6, 45, 'Deposit', 5291, 'Deposit', '4/8/2020');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (6, 46, 'Deposit', 6770, 'ATM Withdrawal', '12/31/2022');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (4, 47, 'Withdrawal', 8427, 'Deposit', '11/9/2020');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (1, 48, 'Withdrawal', 7465, 'Deposit', '4/21/2019');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (6, 49, 'Deposit', 6258, 'Online Transfer', '5/21/2020');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (4, 50, 'Withdrawal', 7372, 'ATM Withdrawal', '6/3/2021');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (6, 51, 'Transfer', 6432, 'Deposit', '3/21/2020');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (1, 52, 'Transfer', 7781, 'ATM Withdrawal', '10/7/2021');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (9, 53, 'Withdrawal', 8381, 'Deposit', '10/17/2022');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (4, 54, 'Transfer', 6957, 'Online Transfer', '6/5/2022');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (1, 55, 'Withdrawal', 5326, 'Online Transfer', '10/26/2019');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (7, 56, 'Withdrawal', 5915, 'Online Transfer', '4/11/2020');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (7, 57, 'Withdrawal', 8915, 'Deposit', '7/5/2021');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (9, 58, 'Withdrawal', 8083, 'Deposit', '6/20/2021');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (8, 59, 'Deposit', 7525, 'Deposit', '12/20/2022');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (1, 60, 'Deposit', 7773, 'Deposit', '11/28/2019');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (6, 61, 'Deposit', 8317, 'Deposit', '10/23/2019');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (2, 62, 'Withdrawal', 5322, 'Online Transfer', '10/28/2022');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (1, 63, 'Transfer', 8771, 'Deposit', '8/19/2020');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (7, 64, 'Deposit', 7845, 'Online Transfer', '11/25/2020');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (6, 65, 'Deposit', 5843, 'Deposit', '7/2/2020');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (4, 66, 'Deposit', 7810, 'Deposit', '7/30/2020');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (7, 67, 'Transfer', 6347, 'Online Transfer', '7/4/2022');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (8, 68, 'Deposit', 5612, 'Deposit', '5/3/2019');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (5, 69, 'Transfer', 7478, 'ATM Withdrawal', '9/17/2021');
insert into Transactions_Table (AccountID, Transaction_ID, Transaction_Type, Amount, Description, Transaction_Date) values (3, 70, 'Transfer', 6823, 'ATM Withdrawal', '11/1/2020');


insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (1, 1, 'Withdrawal', 7429, '2021-08-20 05:43:18', 'ATM_Withdrawal');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (2, 2, 'Deposit', 9668, '2019-07-31 19:22:23', 'Deposit');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (3, 3, 'Withdrawal', 9143, '2021-10-05 19:57:46', 'Online_Transfer');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (4, 4, 'Deposit', 6616, '2020-03-08 22:10:23', 'Online_Transfer');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (5, 5, 'Deposit', 5763, '2021-03-17 10:09:59', 'Deposit');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (6, 6, 'Transfer', 9980, '2020-01-12 06:24:39', 'ATM_Withdrawal');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (7, 7, 'Deposit', 7137, '2020-06-10 18:05:49', 'Deposit');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (8, 8, 'Transfer', 7905, '2021-08-26 12:00:42', 'Deposit');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (9, 9, 'Withdrawal', 8235, '2021-09-14 23:23:26', 'ATM_Withdrawal');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (10, 10, 'Deposit', 6350, '2019-10-09 06:12:06', 'ATM_Withdrawal');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (11, 11, 'Withdrawal', 6958, '2021-10-19 04:38:02', 'ATM_Withdrawal');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (12, 12, 'Withdrawal', 5490, '2021-03-02 02:47:14', 'Online_Transfer');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (13, 13, 'Transfer', 6301, '2021-12-22 14:16:58', 'Online_Transfer');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (14, 14, 'Transfer', 5709, '2020-03-09 14:06:22', 'ATM_Withdrawal');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (15, 15, 'Deposit', 8780, '2021-09-11 17:28:07', 'Deposit');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (16, 16, 'Transfer', 8440, '2019-03-01 12:07:47', 'ATM_Withdrawal');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (17, 17, 'Transfer', 6259, '2021-06-29 19:23:25', 'Deposit');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (18, 18, 'Transfer', 7437, '2021-12-24 13:42:53', 'ATM_Withdrawal');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (19, 19, 'Transfer', 8489, '2020-11-04 02:59:26', 'Deposit');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (20, 20, 'Withdrawal', 5756, '2020-11-25 19:19:56', 'Deposit');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (21, 21, 'Transfer', 9834, '2020-04-28 02:12:43', 'Deposit');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (22, 22, 'Transfer', 8452, '2020-06-07 19:51:20', 'Deposit');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (23, 23, 'Deposit', 8679, '2019-09-02 23:58:54', 'Deposit');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (24, 24, 'Withdrawal', 9202, '2019-07-12 19:42:34', 'Online_Transfer');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (25, 25, 'Transfer', 9732, '2021-10-01 22:57:14', 'ATM_Withdrawal');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (26, 26, 'Transfer', 7720, '2021-01-21 10:06:51', 'Online_Transfer');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (27, 27, 'Withdrawal', 5254, '2020-12-23 08:22:03', 'Deposit');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (28, 28, 'Transfer', 6712, '2019-11-17 07:26:19', 'Online_Transfer');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (29, 29, 'Withdrawal', 8331, '2020-10-17 19:43:38', 'Online_Transfer');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (30, 30, 'Withdrawal', 6493, '2019-04-20 14:41:40', 'Online_Transfer');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (31, 31, 'Withdrawal', 9071, '2020-04-11 21:13:50', 'Online_Transfer');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (32, 32, 'Deposit', 7402, '2019-04-30 15:35:48', 'ATM_Withdrawal');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (33, 33, 'Deposit', 5126, '2019-03-19 13:59:00', 'Online_Transfer');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (34, 34, 'Deposit', 6522, '2020-09-16 19:06:14', 'Deposit');
insert into Transactions_Table (AccountID, Transaction_ID , Transaction_Type, Amount, Transaction_Date, Description) values (35, 35, 'Deposit', 7508, '2021-04-06 17:05:16', 'Online_Transfer');


create table CustomerService_Table (
	IntractionID INT primary key,
	Customer_ID  INT foreign key references Customers_Table(Customer_ID),
	Intransaction_Type VARCHAR(16),
	Resolution_Status VARCHAR(11),
	CustomerService_Date DATE,
	Description VARCHAR(25)
);
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (1, 1, 'Inquiry', 'In_Progress', '2019-05-16 16:11:51', 'Billing-Discrepancy');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (2, 2, 'Request', 'In_Progress', '2021-11-16 16:02:05', 'Technical-Support-Inquiry');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (3, 3, 'Complaint', 'In_Progress', '2019-05-28 17:29:15', 'Account-Access-Issue');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (4, 4, 'Inquiry', 'In_Progress', '2020-03-20 09:30:33', 'Product-Return-Request');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (5, 5, 'Technical_Suppor', 'Pending', '2021-12-07 04:02:18', 'Technical-Support-Inquiry');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (6, 6, 'Complaint', 'In_Progress', '2021-05-02 09:28:56', 'Billing-Discrepancy');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (7, 7, 'Complaint', 'In_Progress', '2021-10-01 14:41:42', 'Technical-Support-Inquiry');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (8, 8, 'Complaint', 'Pending', '2020-12-15 13:42:41', 'Billing-Discrepancy');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (9, 9, 'Complaint', 'Resolved', '2019-02-12 12:04:59', 'Account-Access-Issue');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (10, 10, 'Complaint', 'Pending', '2020-12-05 15:28:16', 'Billing-Discrepancy');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (11, 11, 'Complaint', 'Closed', '2019-04-08 04:00:29', 'Billing-Discrepancy');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (12, 12, 'Technical_Suppor', 'Pending', '2020-08-30 06:50:33', 'Account-Access-Issue');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (13, 13, 'Technical_Suppor', 'Resolved', '2021-06-19 07:31:21', 'Billing-Discrepancy');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (14, 14, 'Inquiry', 'Closed', '2019-12-25 21:00:57', 'Billing-Discrepancy');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (15, 15, 'Request', 'Resolved', '2019-05-24 06:08:44', 'Technical-Support-Inquiry');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (16, 16, 'Technical_Suppor', 'Pending', '2019-02-22 19:24:43', 'Account-Access-Issue');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (17, 17, 'Request', 'Resolved', '2021-05-06 17:18:16', 'Technical-Support-Inquiry');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (18, 18, 'Complaint', 'Pending', '2020-07-08 06:26:34', 'Technical-Support-Inquiry');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (19, 19, 'Technical_Suppor', 'In_Progress', '2021-06-23 22:24:03', 'Billing-Discrepancy');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (20, 20, 'Request', 'Resolved', '2019-08-25 12:51:15', 'Technical-Support-Inquiry');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (21, 21, 'Technical_Suppor', 'In_Progress', '2021-08-12 11:58:13', 'Account-Access-Issue');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (22, 22, 'Technical_Suppor', 'Pending', '2020-07-15 09:03:48', 'Account-Access-Issue');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (23, 23, 'Complaint', 'Resolved', '2021-10-14 07:16:58', 'Account-Access-Issue');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (24, 24, 'Complaint', 'In_Progress', '2021-01-10 21:49:12', 'Product-Return-Request');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (25, 25, 'Inquiry', 'In_Progress', '2019-05-28 09:47:44', 'Account-Access-Issue');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (26, 26, 'Technical_Suppor', 'Closed', '2020-10-14 13:33:00', 'Account-Access-Issue');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (27, 27, 'Technical_Suppor', 'Resolved', '2019-03-15 05:57:11', 'Technical-Support-Inquiry');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (28, 28, 'Request', 'Pending', '2020-07-18 00:12:34', 'Technical-Support-Inquiry');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (29, 29, 'Request', 'In_Progress', '2020-07-20 13:29:40', 'Billing-Discrepancy');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (30, 30, 'Technical_Suppor', 'Resolved', '2020-05-20 10:44:27', 'Technical-Support-Inquiry');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (31, 31, 'Request', 'In_Progress', '2021-01-19 23:59:49', 'Technical-Support-Inquiry');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (32, 32, 'Technical_Suppor', 'Pending', '2021-01-29 22:19:18', 'Account-Access-Issue');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (33, 33, 'Complaint', 'Resolved', '2020-07-05 03:50:39', 'Account-Access-Issue');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (34, 34, 'Inquiry', 'Closed', '2020-03-20 18:43:37', 'Billing-Discrepancy');
insert into CustomerService_Table (IntractionID, Customer_ID , Intransaction_Type, Resolution_Status, CustomerService_Date, Description) values (35, 35, 'Inquiry', 'In_Progress', '2020-08-31 09:36:10', 'Billing-Discrepancy');


create table Feedback_Table (
	FeedbackID INT,
	CustomerID INT foreign key references Customers_Table(Customer_ID),
	Comments VARCHAR(19),
	Score INT,
	Feedback_Date DATE
);
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (1, 1, 'Delivery_Experience', 6, '2022-01-17 14:24:09');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (2, 2, 'Product_Quality', 6, '2021-04-04 03:56:05');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (3, 3, 'Delivery_Experience', 9, '2021-07-14 03:57:33');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (4, 4, 'Product_Quality', 8, '2022-09-27 01:04:46');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (5, 5, 'Staff_Friendliness', 6, '2020-11-19 18:09:25');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (6, 6, 'Excellent_Service', 10, '2022-11-15 14:49:46');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (7, 7, 'Delivery_Experience', 8, '2020-06-26 11:11:54');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (8, 8, 'Excellent_Service', 7, '2020-09-26 08:33:30');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (9, 9, 'Staff_Friendliness', 7, '2022-02-04 13:09:09');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (10, 10, 'Product_Quality', 5, '2023-02-06 10:34:09');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (11, 11, 'Staff_Friendliness', 6, '2022-08-31 09:54:59');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (12, 12, 'Staff_Friendliness', 10, '2021-12-03 07:39:31');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (13, 13, 'Staff_Friendliness', 6, '2021-09-23 11:46:01');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (14, 14, 'Excellent_Service', 9, '2022-12-01 02:14:42');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (15, 15, 'Delivery_Experience', 10, '2022-11-11 02:53:56');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (16, 16, 'Staff_Friendliness', 10, '2021-06-29 16:32:56');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (17, 17, 'Excellent_Service', 8, '2022-12-22 20:18:57');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (18, 18, 'Excellent_Service', 5, '2022-12-22 23:10:16');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (19, 19, 'Delivery_Experience', 7, '2021-02-03 13:02:00');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (20, 20, 'Product_Quality', 5, '2020-07-10 13:48:02');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (21, 21, 'Delivery_Experience', 10, '2020-04-19 20:39:55');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (22, 22, 'Delivery_Experience', 5, '2020-11-15 03:53:39');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (23, 23, 'Excellent_Service', 7, '2021-02-21 01:47:06');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (24, 24, 'Delivery_Experience', 6, '2021-12-16 07:59:31');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (25, 25, 'Staff_Friendliness', 5, '2021-06-09 16:14:41');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (26, 26, 'Excellent_Service', 9, '2023-01-21 08:54:59');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (27, 27, 'Product_Quality', 5, '2021-09-30 17:11:06');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (28, 28, 'Delivery_Experience', 10, '2020-03-01 10:09:47');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (29, 29, 'Delivery_Experience', 9, '2020-03-17 18:19:32');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (30, 30, 'Excellent_Service', 6, '2022-01-23 07:03:36');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (31, 31, 'Product_Quality', 10, '2020-07-20 23:48:19');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (32, 32, 'Excellent_Service', 9, '2022-03-27 14:07:03');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (33, 33, 'Staff_Friendliness', 10, '2021-11-09 15:52:15');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (34, 34, 'Excellent_Service', 7, '2021-07-31 00:03:13');
insert into Feedback_Table (FeedbackID, CustomerID, Comments, Score, Feedback_Date) values (35, 35, 'Excellent_Service', 5, '2021-09-30 12:16:17');



create table Accounts_Table (
	AccountID INT primary key,
	Customer_ID  INT foreign key references Customers_Table(Customer_ID),
	Account_Type VARCHAR(18),
	Opening_Date DATE,
	Status VARCHAR(8),
	Balance INT
);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (1, 1, 'Checking_Account', '2019-03-28 13:30:09', 'Closed', 89056);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (2, 2, 'Checking_Account', '2021-10-10 15:50:39', 'Active', 63728);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (3, 3, 'Investment_Account', '2021-03-07 04:15:32', 'Inactive', 94647);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (4, 4, 'CreditCard_Account', '2019-04-23 07:59:32', 'Inactive', 85421);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (5, 5, 'Checking_Account', '2020-02-14 01:38:35', 'Closed', 90517);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (6, 6, 'Savings_Account', '2020-09-07 18:39:48', 'Active', 69442);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (7, 7, 'Checking_Account', '2020-05-02 01:35:36', 'Frozen', 50433);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (8, 8, 'Savings_Account', '2021-07-02 10:43:06', 'Active', 60096);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (9, 9, 'Savings_Account', '2021-02-06 15:38:01', 'Frozen', 90392);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (10, 10, 'Checking_Account', '2020-05-26 06:14:02', 'Inactive', 64954);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (11, 11, 'Savings_Account', '2020-12-07 08:09:10', 'Inactive', 54744);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (12, 12, 'CreditCard_Account', '2019-09-11 06:44:53', 'Frozen', 88215);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (13, 13, 'Savings_Account', '2019-02-21 01:08:09', 'Closed', 95545);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (14, 14, 'Investment_Account', '2021-10-12 09:45:02', 'Inactive', 82501);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (15, 15, 'Savings_Account', '2021-09-07 05:37:14', 'Inactive', 98829);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (16, 16, 'Savings_Account', '2019-07-21 04:23:50', 'Closed', 68006);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (17, 17, 'CreditCard_Account', '2022-02-07 09:59:01', 'Frozen', 77703);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (18, 18, 'Savings_Account', '2019-03-12 15:49:54', 'Closed', 95602);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (19, 19, 'Checking_Account', '2019-12-16 04:12:13', 'Closed', 92224);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (20, 20, 'Investment_Account', '2021-07-12 22:52:33', 'Closed', 69386);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (21, 21, 'CreditCard_Account', '2020-04-29 09:59:20', 'Active', 89095);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (22, 22, 'Checking_Account', '2020-07-04 03:58:03', 'Closed', 85911);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (23, 23, 'CreditCard_Account', '2021-11-27 03:35:52', 'Inactive', 98168);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (24, 24, 'Savings_Account', '2021-10-31 23:43:49', 'Inactive', 91715);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (25, 25, 'Investment_Account', '2019-07-10 19:08:07', 'Closed', 92371);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (26, 26, 'Savings_Account', '2021-01-29 03:43:04', 'Inactive', 64236);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (27, 27, 'Savings_Account', '2019-03-24 10:17:47', 'Frozen', 85369);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (28, 28, 'Checking_Account', '2020-09-06 22:17:48', 'Inactive', 60093);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (29, 29, 'Checking_Account', '2020-04-19 07:26:25', 'Frozen', 90910);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (30, 30, 'Savings_Account', '2019-03-09 16:41:18', 'Closed', 94979);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (31, 31, 'Savings_Account', '2020-10-24 06:15:35', 'Closed', 99539);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (32, 32, 'Checking_Account', '2021-02-15 18:44:24', 'Active', 54945);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (33, 33, 'Savings_Account', '2022-01-25 21:02:32', 'Frozen', 62284);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (34, 34, 'CreditCard_Account', '2019-11-20 10:53:17', 'Inactive', 76713);
insert into Accounts_Table (AccountID, Customer_ID , Account_Type, Opening_Date, Status, Balance) values (35, 35, 'CreditCard_Account', '2019-03-15 22:43:19', 'Frozen', 73188);


select * from Customers_Table
select * from CustomerService_Table
select * from Accounts_Table
select * from Transactions_Table
select * from Feedback_Table

--Write a query to segment customers based on their transactionvolumes and account types

select * from (
	select Account_Type,sum(Amount) Total_Amount,count(Customer_ID) Number_of_Customer 
	from Accounts_Table at
	inner join Transactions_Table tt on tt.AccountID= at.AccountID
	group by Account_Type
) as tc_at
group by Account_Type, Total_Amount, Number_of_Customer
order by Number_of_Customer

/*Create a query to find customers with transaction volumes abovea certain threshold in the past year. 
where the threshold ismax amount = 1,00,000 */
	--using joins
	select c.*
	from Customers_Table c
	inner JOIN Accounts_Table a on c.Customer_ID = a.Customer_ID
	where Balance > 80000
	--using sub query
	select* from Customers_Table
	where Customer_ID in (select Customer_ID from Accounts_Table 
		where Balance >80000)
/*Write a stored procedure to determine loan eligibility forcustomers based on their 
transaction history and accountbalances*/
go 
create or alter procedure customer_transaction_amount(@customerid int)
as 
begin 
	select sum(tt.Amount) as Total_Transaction, datename(month,tt.Transaction_Date) as Month_of_Transaction ,Transaction_Type
	from Transactions_Table tt
	inner join Accounts_Table at on at.AccountID=tt.AccountID
	inner join Customers_Table ct on ct.Customer_ID=at.Customer_ID
	where ct.Customer_ID=@customerid 
	group by month(tt.Transaction_Date),datename(month,tt.Transaction_Date),Transaction_Type
end;

exec customer_transaction_amount @customerid=1

--Write a query to find the most common types of customer servicerequests.
select Intransaction_Type,count(Intransaction_Type) total_number,
DENSE_RANK() over(order by count(Intransaction_Type) desc) as rnk 
from CustomerService_Table group by Intransaction_Type 

alter table Accounts_Table
add [Status] varchar(100)

/*Create a trigger that automatically updates customer accountstatus based on 
certain transaction criteria*/
go
create or alter trigger SetAccountTypeTrigger
on Transactions_Table
after insert
AS
begin
    declare @amount int
    declare @account_type VARCHAR(50)
    select @amount = Amount from inserted
    if @amount > 75000
        set @account_type = 'premium'
    else
        set  @account_type = 'normal'
    
    update  Accounts_Table
    set Status = @account_type
    where AccountID in (select AccountID from Transactions_Table)
end;

/*ading a column eligibility where value if eligibility is 1 then he is eigible and 
if value is 0 he is not eligible */

alter table Customers_Table
add eligibility int
go
CREATE OR ALTER PROCEDURE eligibility_test
AS 
BEGIN
    UPDATE ct
    SET ct.eligibility = CASE 
                            WHEN (tt.Amount) > 5000 AND at.Balance > 70000 THEN 1
                            ELSE 0
                        END
    FROM Customers_Table ct
    INNER JOIN Accounts_Table at ON ct.Customer_ID = at.Customer_ID
    INNER JOIN Transactions_Table tt ON tt.AccountID = at.AccountID
END
exec eligibility_test

--Create an advanced query to flag potentially fraudulenttransactions based on unusual patterns

select  day(tt.Transaction_Date) perticular_date,Customer_ID, COUNT(*) AS Num_Transactions 
from Accounts_Table at
inner join Transactions_Table tt on at.AccountID= tt.AccountID
group by Transaction_Date,Customer_ID
HAVING COUNT(*) < 3 or sum(Amount) < 2000; 


--Write a query to calculate the average customer satisfactionscore from feedback data
	--Average Score from feedback given
	SELECT AVG(Score) AS AverageScore
	FROM Feedback_Table;


	--Average feedback score per year and per month

	SELECT DATEPART(year, Feedback_Date) AS Year, DATEPART(month,Feedback_Date) AS Month, AVG(Score) AS AverageScore
	FROM Feedback_Table
	GROUP BY DATEPART(year, Feedback_Date),DATEPART(month,Feedback_Date)
	ORDER BY DATEPART(year, Feedback_Date) desc, AVG(Score) desc;


--Create a user-defined function to calculate interest for differentaccount types
go
CREATE OR ALTER FUNCTION CalculateInterestRate
(
    @account_type VARCHAR(50)
)
RETURNS FLOAT
AS
BEGIN
    DECLARE @interest_rate FLOAT;
	-- Calculate interest rate based on account type
    SET @interest_rate = 
            CASE 
                WHEN @account_type = 'Checking_Account' THEN 0.02
                WHEN @account_type = 'CreditCard_Account' THEN 0.15
                WHEN @account_type = 'Investment_Account' THEN 0.05
                WHEN @account_type = 'Savings_Account' THEN 0.03
                ELSE 0
            END;
    RETURN @interest_rate;
END;
go 
SELECT 
    AccountID,
    Account_Type,
    Balance,
    dbo.CalculateInterestRate(Account_Type) AS InterestRate,
   Balance + (Balance * dbo.CalculateInterestRate(Account_Type)) AS TotalAmount
FROM 
    Accounts_Table;

/*Develop a user-defined function to assess credit scores based oncustomer 
transaction history and account balances*/

WITH CustomerTransactions AS (
    SELECT 
        AccountID,
        YEAR(Transaction_Date) AS TransactionYear,
        COUNT(*) OVER (PARTITION BY AccountID) AS TransactionCount,
        ROW_NUMBER() OVER (PARTITION BY AccountID ORDER BY YEAR(Transaction_Date)) AS RowNum
    FROM 
        Transactions_Table
)
SELECT 
    AccountID,
    TransactionYear,
    TransactionCount
FROM 
    CustomerTransactions
WHERE 
    TransactionCount > 1
ORDER BY 
    AccountID, TransactionYear;

go

/*Write a SQL transaction script that rolls back a 
transaction if anattempt to update an account balance fails*/

CREATE or alter PROCEDURE UpdateAccountBalance(
    @amount INT,
    @accountid INT)
AS
BEGIN
    BEGIN TRANSACTION;
    -- Attempt to update the account balance
    UPDATE Accounts_Table
    SET balance = balance - @amount
    WHERE accountid = @accountid;
    -- Check if any rows were affected by the update
    IF @@ROWCOUNT = 0
    BEGIN
        -- Roll back the transaction if no rows were affected (update failed)
        ROLLBACK TRANSACTION;
        PRINT 'Failed to update account balance. Rolling back transaction.';
    END
    ELSE
    BEGIN
        -- Commit the transaction if the update was successful
        COMMIT TRANSACTION;
        PRINT 'Account balance updated successfully.';
    END
END

EXEC UpdateAccountBalance @amount = 1000, @accountid = 1;
EXEC UpdateAccountBalance @amount = 1000, @accountid = 123;


--Add a new column with the identity property
ALTER TABLE Customers_Table
ADD transaction_id INT IDENTITY(1,1);

go

--Develop a trigger on the Transactions table that prevents anaccount balance from going below zero
CREATE OR ALTER TRIGGER PreventExceedingBalance
ON Transactions_Table
INSTEAD OF  INSERT
AS
BEGIN
    DECLARE @AccountID INT;
    DECLARE @Amount DECIMAL(10, 2);
    DECLARE @TransactionType VARCHAR(50);
    DECLARE @CurrentBalance DECIMAL(10, 2);
    -- Get the details of the transaction being inserted
    SELECT @AccountID = AccountID,
           @Amount = Amount,
           @TransactionType = Transaction_Type
    FROM inserted;
    IF @TransactionType IN ('withdrawal', 'transfer') 
    BEGIN
        SELECT @CurrentBalance = Balance
        FROM Accounts_Table
        WHERE AccountID = @AccountID;
        IF @Amount > @CurrentBalance 
        BEGIN
            -- Raise an error message indicating insufficient amount
            RAISERROR('Withdrawal or transfer amount cannot exceed the available balance.', 16, 1);
        END;
    END;
END;

/*Window Function for Running Account Balance: Use a windowfunction to calculate a running total 
of each account's balance over time*/

SELECT AccountID, transaction_date, Amount,
       SUM(Amount) OVER (PARTITION BY AccountID 
	   ORDER BY transaction_date) AS running_balance
FROM Transactions_Table
ORDER BY AccountID, transaction_date;

/*Develop a user-defined function to assess credit scores based oncustomer 
transaction history and account balances*/
go
CREATE or alter FUNCTION CalculateAverageCreditScore (@AccountID INT)
RETURNS float
AS
BEGIN
    DECLARE @AverageCreditScore DECIMAL(18, 2);
    DECLARE @AvgAmountScore INT;
    DECLARE @YearCountScore INT;

    DECLARE @AvgAmount DECIMAL(18, 2);
    SELECT @AvgAmount = AVG(Amount)
    FROM Transactions_Table
    WHERE AccountID = @AccountID;

    DECLARE @YearCount INT;
    SELECT @YearCount = COUNT(DISTINCT YEAR(Transaction_Date))
    FROM Transactions_Table 
    WHERE AccountID = @AccountID;

    IF @AvgAmount > 1000
        SET @AvgAmountScore = 8;
    ELSE IF @AvgAmount > 500
        SET @AvgAmountScore = 7;
    ELSE
        SET @AvgAmountScore = 5;

    IF @YearCount > 2
        SET @YearCountScore = 8;
    ELSE IF @YearCount > 1
        SET @YearCountScore = 7;
    ELSE
        SET @YearCountScore = 5;

    SET @AverageCreditScore = (@AvgAmountScore + @YearCountScore) / 2.0; 

    RETURN  @AverageCreditScore;
END;

DECLARE @AccountID INT = 15; 
SELECT  dbo.CalculateAverageCreditScore(@AccountID) AS AverageCreditScore 